(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))m(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&m(n)}).observe(document,{childList:!0,subtree:!0});function d(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function m(r){if(r.ep)return;r.ep=!0;const i=d(r);fetch(r.href,i)}})();var L=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,o=arguments.length;o--;)e+=arguments[o]*arguments[o];return Math.sqrt(e)});function A(){var e=new L(2);return L!=Float32Array&&(e[0]=0,e[1]=0),e}function C(e){var o=new L(2);return o[0]=e[0],o[1]=e[1],o}function P(e,o){var d=new L(2);return d[0]=e,d[1]=o,d}function N(e,o){return e[0]=o[0],e[1]=o[1],e}function w(e,o,d){return e[0]=o,e[1]=d,e}function Z(e,o,d){return e[0]=o[0]+d[0],e[1]=o[1]+d[1],e}function F(e,o,d){return e[0]=o[0]-d[0],e[1]=o[1]-d[1],e}function $(e,o,d){return e[0]=o[0]*d,e[1]=o[1]*d,e}function M(e,o,d,m){return e[0]=o[0]+d[0]*m,e[1]=o[1]+d[1]*m,e}function k(e,o){var d=o[0]-e[0],m=o[1]-e[1];return Math.hypot(d,m)}function _(e,o){var d=o[0],m=o[1],r=d*d+m*m;return r>0&&(r=1/Math.sqrt(r)),e[0]=o[0]*r,e[1]=o[1]*r,e}function V(e,o){return e[0]*o[0]+e[1]*o[1]}var S=F,G=k;(function(){var e=A();return function(o,d,m,r,i,n){var t,s;for(d||(d=2),m||(m=0),r?s=Math.min(r*d+m,o.length):s=o.length,t=m;t<s;t+=d)e[0]=o[t],e[1]=o[t+1],i(e,e,n),o[t]=e[0],o[t+1]=e[1];return o}})();var D;(e=>{function o(){const d=m=>{const s={with:(c,u)=>d({...m,[c]:u}),addPlayer:c=>{const u=v.player(c);return d({...m,player:u})},addEntity:c=>{const u=m.entities??[],l=v.entity(c,`entity_${u.length+1}`),p=[...u,l];return d({...m,entities:p})},addMirror:(c,u)=>{const l=m.mirrors??[],p={start:C(c),end:C(u),id:`mirror_${l.length+1}`},a=[...l,p];return d({...m,mirrors:a})}};return"player"in m&&"entities"in m&&"mirrors"in m?{...s,build:()=>({...m})}:s};return d({})}e.make=o})(D||(D={}));var v;(e=>{function o(n){return{tag:"player",position:n}}e.player=o;function d([n,t],s){return{tag:"entity",id:s,position:P(n,t),vertices:[P(n,t-e.ENTITY_SIZE),P(n-e.ENTITY_SIZE,t+e.ENTITY_SIZE),P(n+e.ENTITY_SIZE,t+e.ENTITY_SIZE)]}}e.entity=d,e.PLAYER_RADIUS=12,e.ENTITY_SIZE=8,e.MIRROR_SIZE=10;function m([n,t],s){return{id:s,start:P(n-e.MIRROR_SIZE,t),end:P(n+e.MIRROR_SIZE,t)}}e.mirror=m;function r(n){return n.entities}e.entities=r;function i(n,t){return t==="player"?n.player:n.entities.find(s=>s.id===t)||null}e.findEntity=i,(n=>{function t(){return D.make().addPlayer([400,300]).addEntity([350,250]).addMirror([300,200],[300,400]).build()}n.singleMirror=t;function s(){return D.make().addPlayer([400,300]).addEntity([375,264]).addEntity([400,250]).addMirror([300,200],[300,400]).addMirror([500,200],[500,400]).build()}n.twoMirrors=s;function c(){return D.make().addPlayer([400,350]).addEntity([375,264]).addEntity([400,250]).addMirror([300,200],[300,400]).addMirror([300,200],[500,200]).addMirror([500,200],[500,400]).build()}n.threeMirrors=c})(e.Presets||(e.Presets={}))})(v||(v={}));var O;(e=>{class d{constructor(r,i,n={gridSize:128,snapDistance:10}){this.onChange=i,this.canvas=r,this.quantizeConfig=n,this.state={dragState:null,selectedEntity:null,mousePosition:A(),pendingActions:[],isMouseDown:!1,showRays:!0,showVirtualImages:!0},this.setupEventListeners(),this.initGUI()}state;canvas;quantizeConfig;entities=[];player=null;batchTimer=null;batchDelayMs=1;setupEventListeners(){this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.handleMouseLeave.bind(this))}getCanvasCoordinates(r){const i=this.canvas.getBoundingClientRect();return P(r.clientX-i.left,r.clientY-i.top)}findEntityAtPosition(r){if(this.player&&k(r,this.player.position)<=v.PLAYER_RADIUS)return this.player;for(const i of this.entities)if(k(r,i.position)<=20)return i;return null}handleMouseDown(r){const i=this.getCanvasCoordinates(r);N(this.state.mousePosition,i),this.state.isMouseDown=!0;const n=this.findEntityAtPosition(i);if(n){const t=n.tag==="player"?"player":n.id;this.addAction({type:"SELECT_ENTITY",entityId:t}),this.addAction({type:"START_DRAG",entityId:t,position:i})}else this.addAction({type:"DESELECT_ALL"})}handleMouseMove(r){const i=this.getCanvasCoordinates(r);N(this.state.mousePosition,i),this.state.isMouseDown&&this.state.dragState&&this.addAction({type:"UPDATE_DRAG",position:i})}handleMouseUp(){this.state.isMouseDown=!1,this.state.dragState&&(this.addAction({type:"MOVE_ENTITY",entityId:this.state.dragState.entityId,position:this.state.mousePosition}),this.addAction({type:"END_DRAG"}))}handleMouseLeave(){this.state.isMouseDown=!1,this.state.dragState&&this.addAction({type:"END_DRAG"})}addAction(r){this.state.pendingActions.push(r),this.scheduleBatchedOnChange()}scheduleBatchedOnChange(){this.batchTimer!==null&&clearTimeout(this.batchTimer),this.batchTimer=setTimeout(()=>{if(this.batchTimer=null,this.state.pendingActions.length>0){const r=[...this.state.pendingActions];this.state.pendingActions=[],this.onChange(r)}},this.batchDelayMs)}addEntity(){this.addActionImmediate({type:"ADD_OBJECT"})}runSimulation(){this.addActionImmediate({type:"RUN_SIMULATION"})}refreshScene(){this.addActionImmediate({type:"REFRESH_SCENE"})}loadPreset(r){this.addActionImmediate({type:"LOAD_PRESET",preset:r})}addActionImmediate(r){this.state.pendingActions.push(r),this.flushPendingActions()}setEntities(r,i){this.entities=r,this.player=i}getAndClearActions(){const r=[...this.state.pendingActions];return this.state.pendingActions=[],r}flushPendingActions(){if(this.batchTimer!==null&&(clearTimeout(this.batchTimer),this.batchTimer=null),this.state.pendingActions.length>0){const r=[...this.state.pendingActions];this.state.pendingActions=[],this.onChange(r),r.forEach(i=>this.updateState(i))}}updateState(r){switch(r.type){case"SELECT_ENTITY":r.entityId==="player"?this.state.selectedEntity=this.player:this.state.selectedEntity=this.entities.find(i=>i.id===r.entityId)||null;break;case"DESELECT_ALL":this.state.selectedEntity=null;break;case"START_DRAG":this.state.dragState={entityId:r.entityId,entityType:r.entityId=="player"?"player":"entity",startPosition:C(r.position),currentPosition:C(r.position),isDragging:!0};break;case"UPDATE_DRAG":this.state.dragState&&N(this.state.dragState.currentPosition,r.position);break;case"END_DRAG":this.state.dragState=null;break}}getSelectedEntity(){return this.state.selectedEntity}getDragState(){return this.state.dragState}getMousePosition(){return this.state.mousePosition}setValidPositions(r){this.quantizeConfig.validPositions=r}getDragPreviewPosition(){return this.state.dragState?.currentPosition??null}showRays(){return this.state.showRays}showVirtualImages(){return this.state.showVirtualImages}setShowRays(r){this.state.showRays=r,this.triggerRender()}setShowVirtualImages(r){this.state.showVirtualImages=r,this.triggerRender()}triggerRender(){this.onChange([])}destroy(){this.batchTimer!==null&&(clearTimeout(this.batchTimer),this.batchTimer=null),this.canvas.removeEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.removeEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.removeEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.removeEventListener("mouseleave",this.handleMouseLeave.bind(this))}initGUI(){const r=document.createElement("div");r.className="gui-container";const i=document.createElement("div");i.className="gui-row";const n=document.createElement("button");n.className="gui-button",n.textContent="Add Object",n.onclick=()=>this.addEntity(),i.appendChild(n);const t=document.createElement("button");t.className="gui-button gui-button-secondary",t.textContent="Refresh Scene",t.onclick=()=>this.refreshScene(),i.appendChild(t);const s=document.createElement("div");s.className="gui-section";const c=document.createElement("div");c.className="gui-section-label",c.textContent="Presets",s.appendChild(c);const u=document.createElement("div");u.className="gui-section-content";const l=document.createElement("button");l.className="gui-button",l.textContent="Single Mirror",l.onclick=()=>this.loadPreset("one_mirror"),u.appendChild(l);const p=document.createElement("button");p.className="gui-button",p.textContent="Two Mirrors",p.onclick=()=>this.loadPreset("two_mirrors"),u.appendChild(p);const a=document.createElement("button");a.className="gui-button",a.textContent="Three Mirrors",a.onclick=()=>this.loadPreset("three_mirrors"),u.appendChild(a),s.appendChild(u);const E=document.createElement("div");E.className="gui-checkbox-container";const h=document.createElement("input");h.type="checkbox",h.id="show-rays",h.className="gui-checkbox",h.checked=this.state.showRays,h.onchange=()=>this.setShowRays(h.checked);const y=document.createElement("label");y.htmlFor="show-rays",y.className="gui-checkbox-label",y.textContent="Show Rays",E.appendChild(h),E.appendChild(y),i.appendChild(E);const f=document.createElement("div");f.className="gui-checkbox-container";const g=document.createElement("input");g.type="checkbox",g.id="show-virtual-images",g.className="gui-checkbox",g.checked=this.state.showVirtualImages,g.onchange=()=>this.setShowVirtualImages(g.checked);const I=document.createElement("label");I.htmlFor="show-virtual-images",I.className="gui-checkbox-label",I.textContent="Show Virtual Images",f.appendChild(g),f.appendChild(I),i.appendChild(f),r.appendChild(i),r.appendChild(s),document.body.appendChild(r)}}e.Handler=d})(O||(O={}));var Y;(e=>{function m(l,p,a,E){const h=A();S(h,E,a);const y=A();S(y,a,l);const f=p[0]*h[1]-p[1]*h[0];if(Math.abs(f)<1e-6)return null;const I=(y[0]*h[1]-y[1]*h[0])/f;if(I<1e-6)return null;const x=(y[0]*p[1]-y[1]*p[0])/f;if(x<0||x>1)return null;const R=A();M(R,l,p,I);const b=A();return w(b,-h[1],h[0]),_(b,b),{point:R,distance:I,normal:b}}function r(l,p,a,E){const h=A();S(h,a,l);const y=V(h,p);if(y<0)return null;const f=A();$(f,p,y);const g=A();Z(g,l,f);const I=k(g,a);if(I>E)return null;const T=Math.sqrt(E*E-I*I),x=y-T;if(x<1e-6)return null;const R=A();M(R,l,p,x);const b=A();return S(b,R,a),_(b,b),{point:R,distance:x,normal:b}}function i(l,p){const a=A(),E=V(l,p);return M(a,l,p,-2*E),a}function n(l,p,a){const[E,h,y]=a;for(let f=0;f<3;f++){const g=a[f],I=a[(f+1)%3],T=m(l,p,g,I);if(T){const x=A(),R=A(),b=A();return S(R,h,E),S(b,y,E),R[0]*b[1]-R[1]*b[0]>0?w(x,b[1]-R[1],R[0]-b[0]):w(x,R[1]-b[1],b[0]-R[0]),_(x,x),{point:T.point,distance:T.distance,normal:x}}}return null}function t(l,p,a,E=!1){let h=null,y=1/0;for(const f of a.mirrors){const g=m(l,p,f.start,f.end);g&&g.distance<y&&(g.mirrorId=f.id,h=g,y=g.distance)}if(!E){const f=r(l,p,a.player.position,v.PLAYER_RADIUS);f&&f.distance<y&&(h=f,y=f.distance)}for(const f of a.entities){const g=n(l,p,f.vertices);g&&g.distance<y&&(g.entityId=f.id,h=g,y=g.distance)}return h}function s(l,p,a,E=10){const h={origin:C(l),direction:C(p),history:[C(l)]};let y=C(l),f=C(p),g=0,I=!1;for(;g<E;){const T=t(y,f,a,!0);if(!T)break;if(h.history.push(C(T.point)),T.mirrorId){I=!0;const x=i(f,T.normal);y=C(T.point),f=x,g++}else{if(I&&T.entityId)return h.entityId=T.entityId,h;break}}return null}function c(l){return l.history[l.history.length-1]}function u(l){const p=[];for(let E=0;E<128;E++){const h=E/128*Math.PI*2,y=P(Math.cos(h),Math.sin(h)),f=s(l.player.position,y,l);f&&f.history.length>1&&f.entityId&&p.push(f)}return l.entities.map(E=>p.filter(h=>h.entityId===E.id).sort((h,y)=>{const f=G(c(h),E.position),g=G(c(y),E.position);return f-g})[0]).filter(Boolean)}e.trace=u})(Y||(Y={}));var U;(e=>{const o={PLAYER:"#2563eb",PLAYER_SELECTED:"#1d4ed8",OBJECT:"#dc2626",OBJECT_SELECTED:"#b91c1c",MIRROR:"#a5b4fc",RAY:"#fbbf24",VIRTUAL_IMAGE:"#6b7280",DRAG_PREVIEW:"#10b981",BACKGROUND:"#ffffff"};class d{ctx;canvas;options;constructor(i,n={}){this.canvas=i;const t=i.getContext("2d");if(!t)throw new Error("Failed to get 2D rendering context");this.ctx=t,this.options={showRays:!0,showVirtualImages:!0,...n},this.setupCanvas()}setupCanvas(){const i=this.canvas.getBoundingClientRect();this.canvas.width=i.width,this.canvas.height=i.height,this.ctx.imageSmoothingEnabled=!0,this.ctx.lineCap="round",this.ctx.lineJoin="round"}render(i,n=null,t=null,s=null){this.clearCanvas(),this.renderMirrors(i.mirrors),this.renderRays(i.rays),this.renderVirtualImages(i.virtualImages),this.renderObjects(i.entities,n),this.renderPlayer(i.player,n),t&&s&&this.renderDragPreview(t,s)}clearCanvas(){this.ctx.fillStyle=o.BACKGROUND,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}renderPlayer(i,n){const t=n?.tag==="player";this.ctx.fillStyle=t?o.PLAYER_SELECTED:o.PLAYER,this.ctx.strokeStyle=t?o.PLAYER_SELECTED:o.PLAYER,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(i.position[0],i.position[1],v.PLAYER_RADIUS,0,2*Math.PI),this.ctx.fill(),t&&(this.ctx.strokeStyle=o.PLAYER_SELECTED,this.ctx.lineWidth=3,this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.arc(i.position[0],i.position[1],v.PLAYER_RADIUS+5,0,2*Math.PI),this.ctx.stroke(),this.ctx.setLineDash([]))}renderObjects(i,n){for(const t of i)this.renderTriangle(t,n?.tag==="entity"&&n?.id===t.id)}renderTriangle(i,n){this.ctx.fillStyle=n?o.OBJECT_SELECTED:o.OBJECT,this.ctx.strokeStyle=n?o.OBJECT_SELECTED:o.OBJECT,this.ctx.lineWidth=2;const[t,s,c]=i.vertices;this.ctx.beginPath(),this.ctx.moveTo(t[0],t[1]),this.ctx.lineTo(s[0],s[1]),this.ctx.lineTo(c[0],c[1]),this.ctx.closePath(),this.ctx.fill(),n&&(this.ctx.strokeStyle=o.OBJECT_SELECTED,this.ctx.lineWidth=3,this.ctx.setLineDash([5,5]),this.ctx.stroke(),this.ctx.setLineDash([]))}renderMirrors(i){this.ctx.strokeStyle=o.MIRROR,this.ctx.lineWidth=4,this.ctx.lineCap="round";for(const n of i)this.ctx.beginPath(),this.ctx.moveTo(n.start[0],n.start[1]),this.ctx.lineTo(n.end[0],n.end[1]),this.ctx.stroke()}renderRays(i){for(const n of i){if(n.history.length<2)continue;const t=n.history.length-1;for(let s=0;s<t;s++){const c=o.RAY;this.ctx.strokeStyle=this.addAlpha(c,1),this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.moveTo(n.history[s][0],n.history[s][1]),this.ctx.lineTo(n.history[s+1][0],n.history[s+1][1]),this.ctx.stroke()}}}renderVirtualImages(i){for(const n of i){if(!n.isVisible)continue;const t=Math.max(.3,1-n.bounces*.1);if(this.ctx.fillStyle=this.addAlpha(o.VIRTUAL_IMAGE,t),this.ctx.strokeStyle=this.addAlpha(o.VIRTUAL_IMAGE,t),this.ctx.lineWidth=2,this.ctx.setLineDash([3,3]),n.originalType==="player")this.ctx.beginPath(),this.ctx.arc(n.position[0],n.position[1],v.PLAYER_RADIUS,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke();else if(n.originalType==="entity"){const s=v.ENTITY_SIZE,c=n.position[0],u=n.position[1];this.ctx.beginPath(),this.ctx.moveTo(c,u-s),this.ctx.lineTo(c-s,u+s),this.ctx.lineTo(c+s,u+s),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()}else n.originalType==="mirror"&&n.mirrorData&&(this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(n.mirrorData.start[0],n.mirrorData.start[1]),this.ctx.lineTo(n.mirrorData.end[0],n.mirrorData.end[1]),this.ctx.stroke())}this.ctx.setLineDash([])}renderDragPreview(i,n){this.ctx.fillStyle=this.addAlpha(o.DRAG_PREVIEW,.7),this.ctx.strokeStyle=o.DRAG_PREVIEW,this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]);const t=n[0],s=n[1];i.entityId==="player"?(this.ctx.beginPath(),this.ctx.arc(i.currentPosition[0],i.currentPosition[1],v.PLAYER_RADIUS,0,2*Math.PI),this.ctx.stroke(),this.ctx.closePath()):(this.ctx.beginPath(),this.ctx.moveTo(t,s-v.ENTITY_SIZE),this.ctx.lineTo(t-v.ENTITY_SIZE,s+v.ENTITY_SIZE),this.ctx.lineTo(t+v.ENTITY_SIZE,s+v.ENTITY_SIZE),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()),this.ctx.setLineDash([])}addAlpha(i,n){const t=i.replace("#",""),s=parseInt(t.substr(0,2),16),c=parseInt(t.substr(2,2),16),u=parseInt(t.substr(4,2),16);return`rgba(${s}, ${c}, ${u}, ${n})`}setOptions(i){this.options={...this.options,...i}}getCanvasSize(){return{width:this.canvas.width,height:this.canvas.height}}resize(){this.setupCanvas()}}e.Renderer=d;function m(r,i){return new d(r,i)}e.make=m})(U||(U={}));var B;(e=>{function o(t,s){const c=A();S(c,s.end,s.start),_(c,c);const u=A();w(u,-c[1],c[0]);const l=A();S(l,t,s.start);const p=V(l,u),a=A();return M(a,t,u,-2*p),a}function d(t,s){const c=o(t.start,s),u=o(t.end,s);return{id:t.id,start:c,end:u}}function m([t,s],c){return c[0]>=-t&&c[0]<=t*2&&c[1]>=-s&&c[1]<=s*2}function r(t,s,c,u,l){const p=[],a=o(s.player.position,c);m(t,a)&&p.push({originalId:"player",originalType:"player",position:a,bounces:u,isVisible:!0,mirrorChain:[...l,c.id],virtualRoom:u});for(const E of s.entities){const h=o(E.position,c);m(t,h)&&p.push({originalId:E.id,originalType:"entity",position:h,bounces:u,isVisible:!0,mirrorChain:[...l,c.id],virtualRoom:u})}for(const E of s.mirrors){const h=d(E,c),y=A();Z(y,h.start,h.end),$(y,y,.5),(m(t,h.start)||m(t,h.end)||m(t,y))&&p.push({originalId:E.id,originalType:"mirror",position:y,bounces:u,isVisible:!0,mirrorChain:[...l,c.id],virtualRoom:u,mirrorData:{start:C(h.start),end:C(h.end)}})}return p}function i(t,s,c,u,l){const p=[];for(const a of c){if(l.includes(a.id))continue;const E=r(t,s,a,u,l);p.push(...E);const h={player:{...s.player,position:o(s.player.position,a)},entities:s.entities.map(f=>({...f,position:o(f.position,a)})),mirrors:s.mirrors.map(f=>d(f,a))},y=i(t,h,c,u+1,[...l,a.id]);p.push(...y)}return p}function n(t,s){const c={player:t.player,entities:t.entities,mirrors:t.mirrors};return i(s,c,t.mirrors,1,[])}e.calculateVirtualImages=n})(B||(B={}));var H;(e=>{function o(t,s){const c=s?Y.trace(t):[];return{...t,rays:c}}e.withRays=o;function d(t,s,c){const u=c?B.calculateVirtualImages(t,s):[];return{...t,virtualImages:u}}e.withVirtualImages=d;function m(t,s,c){const u=o(t,c.showRays);return d(u,s,c.showVirtualImages)}e.processScene=m;function r(t,{entityId:s,position:c}){if(s==="player")return{...t,player:{...t.player,position:C(c)}};const u=t.entities.findIndex(l=>l.id===s);if(u!==-1){const l=[...t.entities];return l[u]=v.entity(c,`entity_${t.entities.length+1}`),{...t,entities:l}}return t}e.moveEntity=r;function i(t,s){const c=v.entity(s,`entity_${t.entities.length+1}`);return{...t,entities:[...t.entities,c]}}e.addEntity=i;function n(t){const s=document.getElementById("lesson");if(!s){alert("Could not find canvas! This should be impossible");return}const c=s.getBoundingClientRect(),u=P(c.width,c.height),l=new O.Handler(s,h),p=U.make(s);let a={canvas:s,scene:t,inputHandler:l,renderer:p};function E(g){switch(g.type){case"MOVE_ENTITY":{const I=r(a.scene,g);a.inputHandler.setEntities(v.entities(I),I.player),a={...a,scene:I};break}case"ADD_OBJECT":{const I=P(400,250),T=i(a.scene,I);a.inputHandler.setEntities(v.entities(T),T.player),a={...a,scene:T};break}case"RUN_SIMULATION":break;case"REFRESH_SCENE":{const I={...t};a.inputHandler.setEntities(v.entities(I),I.player),a={...a,scene:I};break}case"LOAD_PRESET":{let I;switch(g.preset){case"one_mirror":I=v.Presets.singleMirror();break;case"two_mirrors":I=v.Presets.twoMirrors();break;case"three_mirrors":I=v.Presets.threeMirrors();break;default:I=a.scene}a.inputHandler.setEntities(v.entities(I),I.player),a={...a,scene:I};break}case"SELECT_ENTITY":break;case"DESELECT_ALL":break;case"START_DRAG":break;case"UPDATE_DRAG":break;case"END_DRAG":break;default:console.error("Unreachable case!",g)}}function h(g){g.forEach(x=>{E(x),a.inputHandler.updateState(x)});const I={showRays:a.inputHandler.showRays(),showVirtualImages:a.inputHandler.showVirtualImages()},T=m(a.scene,u,I);a.renderer.render(T,a.inputHandler.getSelectedEntity(),a.inputHandler.getDragState(),a.inputHandler.getDragPreviewPosition())}a.inputHandler.setEntities(v.entities(a.scene),a.scene.player);const y={showRays:a.inputHandler.showRays(),showVirtualImages:a.inputHandler.showVirtualImages()},f=m(a.scene,u,y);a.renderer.render(f,a.inputHandler.getSelectedEntity(),a.inputHandler.getDragState(),a.inputHandler.getDragPreviewPosition())}e.run=n})(H||(H={}));function W(){const e=D.make().addPlayer([400,300]).addEntity([375,264]).addEntity([400,250]).addMirror([300,200],[300,400]).addMirror([500,200],[500,400]).build();H.run(e)}document.addEventListener("DOMContentLoaded",W);
